<!--index.html - 인터섹션 옵저버를 활용한 성능 최적화-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Tech Shop</title>

    <!-- 메타 태그 및 프리로드 추가 -->
    <meta name="description" content="VR Headsets - Discover our line of premium VR headsets">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- CSS 파일 프리로드 -->
    <link rel="preload" href="/css/styles.css" as="style">
    <link rel="preconnect" href="https://fakestoreapi.com">

    <!-- 중요한 이미지 프리로드 (WebP 포맷으로 교체) -->
    <link rel="preload" href="images/Hero_Desktop.webp" as="image" media="(min-width: 961px)" fetchpriority="high">
    <link rel="preload" href="images/Hero_Tablet.webp" as="image" media="(min-width: 577px) and (max-width: 960px)" fetchpriority="high">
    <link rel="preload" href="images/Hero_Mobile.webp" as="image" media="(max-width: 576px)" fetchpriority="high">

    <!-- 폰트 스타일시트 로드 -->
    <link href="https://fonts.googleapis.com/css?family=Heebo:300,400,600,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">

    <!-- Google Tag Manager - 스크립트 지연 로드 -->
    <script>
      window.addEventListener('load', function() {
        // 지연 로드를 위한 requestIdleCallback 사용
        if ('requestIdleCallback' in window) {
          requestIdleCallback(function() {
            loadGTM();
          }, { timeout: 5000 });
        } else {
          // 폴백: setTimeout 사용
          setTimeout(function() {
            loadGTM();
          }, 2000);
        }

        function loadGTM() {
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
              new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-PKK35GL5');
        }
      });
    </script>

    <!-- Cookie Consent - defer 속성 추가 -->
    <script type="text/javascript" src="//www.freeprivacypolicy.com/public/cookie-consent/4.1.0/cookie-consent.js" charset="UTF-8" defer></script>
    <script type="text/javascript" charset="UTF-8">
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof cookieconsent !== 'undefined') {
          cookieconsent.run({"notice_banner_type":"simple","consent_type":"express","palette":"light","language":"en","page_load_consent_levels":["strictly-necessary"],"notice_banner_reject_button_hide":false,"preferences_center_close_button_hide":false,"page_refresh_confirmation_buttons":false,"website_name":"Performance Course"});
        }
      });
    </script>

    <!-- 프로그레시브 이미지 로딩을 위한 스타일 -->
    <style>
        .progressive-image {
            width: 100%;
            height: auto;
            transition: filter 0.3s ease-out;
        }
        .progressive-image.blur {
            filter: blur(10px);
        }
        .progressive-image.loaded {
            filter: blur(0);
        }

        /* 이미지 플레이스홀더 스타일 */
        .image-placeholder {
            background-color: #f0f0f0;
            position: relative;
            overflow: hidden;
        }

        .image-placeholder::before {
            content: "";
            display: block;
            position: absolute;
            left: -150px;
            top: 0;
            height: 100%;
            width: 150px;
            background: linear-gradient(to right, transparent 0%, #e0e0e0 50%, transparent 100%);
            animation: loading 1.5s cubic-bezier(0.4, 0.0, 0.2, 1) infinite;
        }

        @keyframes loading {
            from {
                left: -150px;
            }
            to {
                left: 100%;
            }
        }

        /* 제품 청크 플레이스홀더 스타일 */
        .product-chunk-placeholder {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            min-height: 300px;
            background-color: #f9f9f9;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .product-chunk-placeholder::before {
            content: "";
            display: block;
            position: absolute;
            left: -150px;
            top: 0;
            height: 100%;
            width: 150px;
            background: linear-gradient(to right, transparent 0%, #e0e0e0 50%, transparent 100%);
            animation: loading 1.5s cubic-bezier(0.4, 0.0, 0.2, 1) infinite;
        }
    </style>
</head>

<body>
<!-- Google Tag Manager (noscript) - 비동기 로드 -->
<noscript id="gtm-noscript"></noscript>
<script>
  // noscript iframe을 지연 로드
  window.addEventListener('load', function() {
    setTimeout(function() {
      document.getElementById('gtm-noscript').innerHTML = '<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKK35GL5" height="0" width="0" style="display:none;visibility:hidden"></iframe>';
    }, 2000);
  });
</script>

<header>
    <div class="container">
        <section class="logo">
            <a href="index.html">
                <strong>VR</strong>
                <span class="blue-dot"></span>
                <span class="blue-dot"></span>
                <span>Headsets</span>
            </a>
        </section>
        <nav>
            <ul>
                <li><a href="about.html">About us</a></li>
                <li><a href="index.html#best-sellers-section">Best Sellers</a></li>
                <li><a href="index.html#newsletter-section">Newsletter</a></li>
                <li class="menu-icon"><img src="images/menu_icon.webp" alt="Menu icon" width="24" height="24"></li>
            </ul>
        </nav>
    </div>
</header>

<section class="hero">
    <!-- 반응형 이미지 및 WebP 포맷 지원 추가 -->
    <picture>
        <source srcset="images/Hero_Desktop.webp" media="(min-width: 961px)" type="image/webp">
        <source srcset="images/Hero_Desktop.jpg" media="(min-width: 961px)" type="image/jpeg">

        <source srcset="images/Hero_Tablet.webp" media="(min-width: 577px) and (max-width: 960px)" type="image/webp">
        <source srcset="images/Hero_Tablet.jpg" media="(min-width: 577px) and (max-width: 960px)" type="image/jpeg">

        <source srcset="images/Hero_Mobile.webp" media="(max-width: 576px)" type="image/webp">
        <source srcset="images/Hero_Mobile.jpg" media="(max-width: 576px)" type="image/jpeg">

        <!-- 폴백 이미지 - fetchpriority="high" 추가 -->
        <img class="desktop" src="images/Hero_Desktop_Placeholder.jpg"
             data-src="images/Hero_Desktop.jpg"
             alt="VR Headsets" width="1440" height="660"
             class="progressive-image blur"
             fetchpriority="high">
    </picture>

    <div class="hero-content">
        <div class="container">
            <h1>Discover our line of VR Headsets</h1>
            <p>
                Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium
                doloremque laudantium.
            </p>
            <button>View Headsets</button>
        </div>
    </div>
</section>

<section class="country-bar hidden">
    <!-- 여기에 국가 정보가 동적으로 추가됩니다 -->
</section>

<!-- Best Sellers 섹션 - 이미지 최적화 적용 -->
<section class="best-sellers" id="best-sellers-section">
    <h1>Best Sellers</h1>
    <hr>
    <div class="product-slider">
        <div class="container">
            <div class="product new">
                <div class="product-picture">
                    <!-- 이미지 지연 로딩 적용 -->
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 250 250' fill='%23f0f0f0'%3E%3Crect width='250' height='250' /%3E%3C/svg%3E"
                         data-src="images/vr1.webp"
                         alt="product: Apple Headset"
                         width="250" height="250"
                         class="progressive-image blur">
                </div>
                <div class="product-info">
                    <h5 class="categories">Headsets, Apple</h5>
                    <h4 class="title">Apple Headset</h4>
                    <h3 class="price">
                        <span>US$ 450.00</span>
                    </h3>
                    <button>ADD TO BAG</button>
                </div>
            </div>

            <div class="product new">
                <div class="product-picture">
                    <!-- 이미지 지연 로딩 적용 -->
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 250 250' fill='%23f0f0f0'%3E%3Crect width='250' height='250' /%3E%3C/svg%3E"
                         data-src="images/vr2.webp"
                         alt="product: Playstation Headset"
                         width="250" height="250"
                         class="progressive-image blur">
                </div>
                <div class="product-info">
                    <h5 class="categories">Headsets, PS</h5>
                    <h4 class="title">Playstation Headset</h4>
                    <h3 class="price">
                        <span>US$ 399.99</span>
                    </h3>
                    <button>ADD TO BAG</button>
                </div>
            </div>

            <div class="product">
                <div class="product-picture">
                    <!-- 이미지 지연 로딩 적용 -->
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 250 250' fill='%23f0f0f0'%3E%3Crect width='250' height='250' /%3E%3C/svg%3E"
                         data-src="images/vr3.webp"
                         alt="product: Oculus Headset"
                         width="250" height="250"
                         class="progressive-image blur">
                </div>
                <div class="product-info">
                    <h5 class="categories">Headsets, Oculus</h5>
                    <h4 class="title">Oculus Headset</h4>
                    <h3 class="price">
                        <span class="discounted-price">US$ 349.99</span>
                        <span class="original-price">US$ 419.99</span>
                    </h3>
                    <button>ADD TO BAG</button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- All Products 섹션 - 인터섹션 옵저버로 지연 로딩 설정 -->
<section class="best-sellers">
    <h1>All Products</h1>
    <hr>
    <div class="product-slider" id="all-products" data-lazy-action="load-products">
        <div class="container">
            <!-- 동적으로 생성될 제품 목록 -->
            <!-- 초기 로딩 상태 표시 -->
            <div class="product-chunk-placeholder">
                <!-- 로딩 중 상태 표시 -->
            </div>
        </div>
    </div>
</section>

<section class="newsletter" id="newsletter-section">
    <h3>Newsletter Signup</h3>
    <p>Subscribe now and don't miss a single deal!</p>
    <form>
        <input type="email" name="email" placeholder="Your email...">
        <button type="submit">Subscribe</button>
    </form>
</section>

<footer>
    <div class="bottom-nav">
        <div class="container">
            <ul>
                <li class="list-title">Categories</li>
                <li><a href="#">Watches</a></li>
                <li><a href="#">Cameras</a></li>
                <li><a href="#">Phones</a></li>
                <li><a href="#">Tablets</a></li>
                <li><a href="#">Computers</a></li>
            </ul>

            <ul>
                <li class="list-title">About Us</li>
                <li><a href="#">Our Story</a></li>
                <li><a href="#">Press</a></li>
                <li><a href="#">Blog</a></li>
                <li><a href="#">Awards</a></li>
                <li><a href="#">Stores</a></li>
            </ul>

            <ul>
                <li class="list-title">Social Media</li>
                <li><a href="#">Facebook</a></li>
                <li><a href="#">Linkedin</a></li>
                <li><a href="#">Instagram</a></li>
                <li><a href="#">Twitter</a></li>
                <li><a href="#">Youtube</a></li>
            </ul>

            <ul>
                <li class="list-title">Customer Service</li>
                <li><a href="#">Live Chat</a></li>
                <li><a href="#">Contact Us</a></li>
                <li><a href="#">Terms & Conditions</a></li>
                <li><a href="#">Delivery & Returns</a></li>
                <li><a href="#">Finance</a></li>
            </ul>
        </div>
    </div>
    <div class="copyright-text">
        2020 &copy; All Rights Reserved
    </div>
</footer>

<a href="#" id="open_preferences_center">Update cookies preferences</a>

<!-- 모듈 타입으로 스크립트 로드 - defer 속성 추가 -->
<script type="module" src="./js/main.js" defer></script>
<!-- products.js는 main.js에서 동적으로 로드됨 -->
</body>
</html>